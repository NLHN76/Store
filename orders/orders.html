<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÄÆ¡n HÃ ng - Mobile Gear</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<main class="flex-1 p-6 max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">ThÃ´ng Tin ÄÆ¡n HÃ ng</h1>

    <!-- NÃºt lá»c tráº¡ng thÃ¡i -->
    <div id="status-filters" class="flex flex-wrap justify-center gap-2 mb-6"></div>

    <!-- Danh sÃ¡ch Ä‘Æ¡n hÃ ng -->
<div id="order-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 
    max-h-[70vh] overflow-y-auto p-2 bg-gray-50 rounded">
</div>

</main>

<footer class="bg-gray-800 text-white p-4 text-center text-sm">
    <p>Copyright @2025 mobilegear.vn</p>
</footer>





<script>
let allOrders = []; // LÆ°u táº¥t cáº£ Ä‘Æ¡n hÃ ng

// Map tráº¡ng thÃ¡i â†’ icon + mÃ u
const statusMap = {
    "Chá» xá»­ lÃ½":        {icon: "ğŸ•’", class: "text-gray-500 font-semibold"},
    "Chá» thanh toÃ¡n":   {icon: "ğŸ•“", class: "text-orange-500 font-semibold"},
    "ÄÃ£ thanh toÃ¡n":    {icon: "âœ”ï¸", class: "text-green-600 font-semibold"},
    "Äang xá»­ lÃ½":       {icon: "âš ï¸", class: "text-yellow-500 font-semibold"},
    "Äang giao hÃ ng":   {icon: "ğŸšš", class: "text-blue-500 font-semibold"},
    "ÄÃ£ giao hÃ ng":     {icon: "âœ…", class: "text-green-700 font-semibold"},
    "ÄÃ£ há»§y":           {icon: "âŒ", class: "text-red-500 font-semibold"}
};

// Fetch danh sÃ¡ch Ä‘Æ¡n hÃ ng
async function fetchOrders() {
    try {
        const response = await fetch('order.php');
        const data = await response.json();
        if(data.status === 'error'){
            document.getElementById('order-list').innerHTML = `<p class="col-span-full text-red-500 text-center">${data.message}</p>`;
            return;
        }
        allOrders = data;
        renderStatusFilters();
        renderOrders(allOrders);
    } catch(error) {
        console.error(error);
        document.getElementById('order-list').innerHTML = `<p class="col-span-full text-red-500 text-center">KhÃ´ng thá»ƒ táº£i thÃ´ng tin Ä‘Æ¡n hÃ ng.</p>`;
    }
}

// Táº¡o nÃºt lá»c tráº¡ng thÃ¡i
function renderStatusFilters() {
    const filterContainer = document.getElementById('status-filters');
    filterContainer.innerHTML = '';

    const statuses = Object.keys(statusMap);
    statuses.unshift('Táº¥t cáº£');

    statuses.forEach(status => {
        const btn = document.createElement('button');
        btn.textContent = status;
        btn.className = 'px-4 py-2 rounded-md border hover:bg-gray-200 transition-all';
        btn.addEventListener('click', () => {
            // XÃ³a active cá»§a táº¥t cáº£ nÃºt
            filterContainer.querySelectorAll('button').forEach(b => b.classList.remove('border-b-2','border-blue-500','font-bold'));
            // ThÃªm active cho nÃºt Ä‘Æ°á»£c click
            btn.classList.add('border-b-2','border-blue-500','font-bold');

            if(status === 'Táº¥t cáº£') renderOrders(allOrders);
            else renderOrders(allOrders.filter(order => order.status === status));
        });
        filterContainer.appendChild(btn);
    });

    // Máº·c Ä‘á»‹nh chá»n Táº¥t cáº£
    filterContainer.querySelector('button').classList.add('border-b-2','border-blue-500','font-bold');
}

// Render danh sÃ¡ch Ä‘Æ¡n hÃ ng
function renderOrders(orders) {
    const orderList = document.getElementById('order-list');
    orderList.innerHTML = '';
    if(orders.length === 0){
        orderList.innerHTML = `<p class="col-span-full text-center text-gray-500">KhÃ´ng cÃ³ Ä‘Æ¡n hÃ ng nÃ o</p>`;
        return;
    }

    orders.forEach(order => {
        const formattedPrice = parseFloat(order.total_price).toLocaleString('de-DE');
        const colors = order.color || 'KhÃ´ng cÃ³ mÃ u';
        const status = statusMap[order.status] || {icon: "â“", class: "text-gray-500"};

        const orderCard = document.createElement('div');
        orderCard.className = 'bg-white shadow-md rounded-lg p-6 flex flex-col';

        orderCard.innerHTML = `
            <h3 class="text-xl font-bold mb-2">MÃ£ ÄÆ¡n HÃ ng: ${order.id}</h3>
            <div class="flex-1">
                <p><strong>Sá»‘ Äiá»‡n Thoáº¡i:</strong> ${order.customer_phone}</p>
                <p><strong>Äá»‹a Chá»‰:</strong> ${order.customer_address}</p>
                <p><strong>Sáº£n Pháº©m:</strong> ${order.product_name}</p>
                <p><strong>Loáº¡i Sáº£n Pháº©m:</strong> ${order.category}</p>
                <p><strong>MÃ u Sáº¯c:</strong> ${colors}</p>
                <p><strong>Sá»‘ LÆ°á»£ng:</strong> ${order.product_quantity}</p>
                <p><strong>Tá»•ng Tiá»n:</strong> ${formattedPrice} VNÄ</p>
                <p><strong>NgÃ y Thanh ToÃ¡n:</strong> ${order.order_date}</p>
                <p><strong>Tráº¡ng ThÃ¡i:</strong> <span class="${status.class}">${status.icon} ${order.status}</span></p>
                ${order.status === "Chá» xá»­ lÃ½" ? `<button class="mt-2 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600" onclick="cancelOrder(${order.id})">Há»§y Ä‘Æ¡n</button>` : ''}
            </div>
        `;
        orderList.appendChild(orderCard);
    });
}

// Há»§y Ä‘Æ¡n
function cancelOrder(orderId) {
    if(!confirm("Báº¡n cÃ³ cháº¯c muá»‘n há»§y Ä‘Æ¡n hÃ ng nÃ y?")) return;

    fetch('cancel_order.php', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({id: orderId})
    })
    .then(res => res.json())
    .then(data => {
        if(data.status === 'success'){
            alert("ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c há»§y!");
            fetchOrders();
        } else {
            alert("Há»§y Ä‘Æ¡n tháº¥t báº¡i: " + data.message);
        }
    })
    .catch(err => {console.error(err); alert("CÃ³ lá»—i xáº£y ra.");});
}

document.addEventListener('DOMContentLoaded', fetchOrders);
</script>

</body>
</html>
